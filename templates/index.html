<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè• Gastrointestinal Disease Detection</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .main-header {
            font-size: 3rem;
            color: #1f77b4;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .info-box {
            background-color: #f0f7ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #1f77b4;
        }
        
        .prediction-box {
            background-color: #e8f4f8;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }
        
        .disease-name {
            font-size: 1.8rem;
            font-weight: bold;
            color: #d9534f;
        }
        
        .confidence {
            font-size: 1.2rem;
            color: #5cb85c;
        }
        
        .upload-box {
            border: 2px dashed #1f77b4;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }
        
        .placeholder-container {
            width: 100%;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px dashed #ccc;
            border-radius: 10px;
            background-color: #f9f9f9;
        }
        
        .placeholder-text {
            color: #888;
            font-size: 1.2rem;
        }
        
        .row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .col {
            flex: 1;
        }
        
        button {
            background-color: #1f77b4;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 10px;
        }
        
        button:hover {
            background-color: #1668a1;
        }
        
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .progress-container {
            margin: 10px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #4CAF50;
            transition: width 0.3s ease;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .disclaimer {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            border-left: 5px solid #ffc107;
            margin-top: 20px;
        }
        
        .accordion {
            margin-bottom: 20px;
        }
        
        .accordion-header {
            background-color: #f8f9fa;
            padding: 15px;
            border: 1px solid #dee2e6;
            cursor: pointer;
            border-radius: 5px;
        }
        
        .accordion-content {
            padding: 15px;
            border: 1px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 5px 5px;
            display: none;
        }
        
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="main-header">üè• Gastrointestinal Disease Detection</h1>
        
        <!-- About Section -->
        <div class="accordion">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                ‚ÑπÔ∏è About Gastrointestinal Diseases and This Tool
            </div>
            <div class="accordion-content">
                <h3>Gastrointestinal Tract Diseases</h3>
                <p>The gastrointestinal (GI) tract plays a crucial role in digestion and nutrient absorption. 
                Diseases affecting the GI tract can significantly impact quality of life and require accurate diagnosis for proper treatment.</p>
                
                <p>This tool uses a deep learning model to classify endoscopic images into one of 8 categories:</p>
                <ol>
                    <li><strong>dyed-lifted-polyps</strong> - Polyps that have been dyed and lifted for removal</li>
                    <li><strong>dyed-resection-margins</strong> - Margins of resected tissue that have been dyed</li>
                    <li><strong>esophagitis</strong> - Inflammation of the esophagus</li>
                    <li><strong>normal-cecum</strong> - Healthy cecum appearance</li>
                    <li><strong>normal-pylorus</strong> - Healthy pylorus appearance</li>
                    <li><strong>normal-z-line</strong> - Healthy z-line appearance</li>
                    <li><strong>ulcerative-colitis</strong> - Chronic inflammatory bowel disease</li>
                    <li><strong>polyps</strong> - Abnormal tissue growths</li>
                </ol>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <div class="info-box">
                    <h3>üìã Instructions</h3>
                    <ol>
                        <li>Upload an endoscopic image using the file uploader</li>
                        <li>Supported formats: JPG, JPEG, PNG</li>
                        <li>Click the "Analyze Image" button to process</li>
                        <li>Results will show the predicted condition and confidence level</li>
                    </ol>
                </div>
                
                <h3>üì§ Upload Image</h3>
                <div class="upload-box">
                    <input type="file" id="fileInput" accept=".jpg,.jpeg,.png">
                    <button id="analyzeBtn" disabled>üîç Analyze Image</button>
                </div>
            </div>
            
            <div class="col">
                <div id="imageContainer">
                    <div class="placeholder-container">
                        <p class="placeholder-text">Image preview will appear here</p>
                    </div>
                </div>
                
                <div id="resultsContainer" style="display: none;">
                    <div class="prediction-box">
                        <h3>üìä Prediction Results</h3>
                        <p id="predictedClass" class="disease-name"></p>
                        <p id="confidence" class="confidence"></p>
                    </div>
                    
                    <h3 style="margin-top: 20px;">Confidence Breakdown</h3>
                    <div id="confidenceBreakdown"></div>
                </div>
            </div>
        </div>

        <!-- Disclaimer -->
        <div class="disclaimer">
            <strong>‚ö†Ô∏è Important Disclaimer:</strong> This tool is for educational and research purposes only. 
            It is not a substitute for professional medical advice, diagnosis, or treatment. 
            Always seek the advice of qualified healthcare providers with questions about medical conditions.
        </div>
    </div>

    <script>
        function toggleAccordion(header) {
            const content = header.nextElementSibling;
            content.style.display = content.style.display === 'block' ? 'none' : 'block';
        }

        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('fileInput');
            const analyzeBtn = document.getElementById('analyzeBtn');
            const imageContainer = document.getElementById('imageContainer');
            const resultsContainer = document.getElementById('resultsContainer');
            const predictedClass = document.getElementById('predictedClass');
            const confidence = document.getElementById('confidence');
            const confidenceBreakdown = document.getElementById('confidenceBreakdown');
            
            fileInput.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = function(event) {
                        imageContainer.innerHTML = `<img src="${event.target.result}" style="max-width: 100%; border-radius: 10px;" alt="Uploaded Image">`;
                        analyzeBtn.disabled = false;
                        resultsContainer.style.display = 'none';
                    };
                    
                    reader.readAsDataURL(file);
                }
            });
            
            analyzeBtn.addEventListener('click', function() {
                if (!fileInput.files.length) return;
                
                const file = fileInput.files[0];
                const formData = new FormData();
                formData.append('file', file);
                
                analyzeBtn.disabled = true;
                analyzeBtn.innerHTML = '<div class="spinner"></div>Analyzing...';
                
                fetch('/predict', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        alert('Error: ' + data.error);
                        return;
                    }
                    
                    // Display results
                    predictedClass.textContent = 'Predicted: ' + data.predicted_class;
                    confidence.textContent = 'Confidence: ' + data.confidence.toFixed(2) + '%';
                    
                    // Display confidence breakdown
                    confidenceBreakdown.innerHTML = '';
                    for (const [label, pred] of Object.entries(data.all_predictions)) {
                        const progressContainer = document.createElement('div');
                        progressContainer.className = 'progress-container';
                        
                        const labelDiv = document.createElement('div');
                        labelDiv.className = 'progress-label';
                        labelDiv.innerHTML = `<span>${label}</span><span>${pred.toFixed(2)}%</span>`;
                        
                        const progressBar = document.createElement('div');
                        progressBar.className = 'progress-bar';
                        
                        const progressFill = document.createElement('div');
                        progressFill.className = 'progress-fill';
                        progressFill.style.width = pred + '%';
                        
                        progressBar.appendChild(progressFill);
                        progressContainer.appendChild(labelDiv);
                        progressContainer.appendChild(progressBar);
                        confidenceBreakdown.appendChild(progressContainer);
                    }
                    
                    resultsContainer.style.display = 'block';
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while processing the image.');
                })
                .finally(() => {
                    analyzeBtn.disabled = false;
                    analyzeBtn.innerHTML = 'üîç Analyze Image';
                });
            });
        });
    </script>
</body>
</html>